<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>ðŸ’¬ Discord Style Chat</title>
  <style>
    body { font-family: Arial; margin: 0; padding: 0; background: #2f3136; color: #fff; display: flex; flex-direction: column; height: 100vh; }
    h2 { text-align: center; margin: 16px 0; }
    #chatBox { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; }
    .message-group { display: flex; align-items: flex-start; margin-bottom: 15px; }
    .profile-pic { width: 30px; height: 30px; border-radius: 50%; margin-left: 10px; }
    .content { background: #40444b; padding: 10px; border-radius: 8px; max-width: 70%; }
    .username { font-weight: bold; color: #00b0f4; margin-bottom: 5px; }
    .timestamp { color: #999; font-size: 10px; margin-left: 5px; }
    #inputArea { display: flex; padding: 10px; background: #36393f; }
    #message { flex: 1; padding: 10px; border: none; border-radius: 8px; margin-right: 8px; font-size: 14px; resize: none; }
    #sendBtn { padding: 10px 20px; border: none; border-radius: 8px; background: #5865f2; color: #fff; cursor: pointer; }
    #auth { padding: 10px; text-align: center; background: #202225; }
  </style>
</head>
<body>
  <div id="auth"></div>
  <h2>ðŸ’¬ Real-Time Chat</h2>
  <div id="chatBox"></div>
  <div id="inputArea" style="display:none;">
    <textarea id="message" placeholder="Type a message..." rows="1"></textarea>
    <button id="sendBtn" onclick="sendMessage()">Send</button>
  </div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyA6C9AQ1kUtxTILR6v8mmlQkuz9UTHjHv0",
      authDomain: "notion-chat-c7ff1.firebaseapp.com",
      projectId: "notion-chat-c7ff1",
      storageBucket: "notion-chat-c7ff1.appspot.com",
      messagingSenderId: "1052307211297",
      appId: "1:1052307211297:web:aa81f9649cf607202c8f60"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    const authDiv = document.getElementById('auth');
    const chatBox = document.getElementById('chatBox');
    const inputArea = document.getElementById('inputArea');
    const messageField = document.getElementById('message');

    auth.setPersistence(firebase.auth.Auth.Persistence.LOCAL);

    auth.onAuthStateChanged(user => {
      if (user) {
        authDiv.innerHTML = `<p>ðŸ‘¤ ${user.displayName} <button onclick="logout()">Logout</button></p>`;
        inputArea.style.display = 'flex';
        loadMessages();
      } else {
        authDiv.innerHTML = `<button onclick="login()">Login with Google</button>`;
        inputArea.style.display = 'none';
      }
    });

    function login() {
      const provider = new firebase.auth.GoogleAuthProvider();
      auth.signInWithPopup(provider);
    }

    function logout() {
      auth.signOut();
    }

    function sendMessage() {
      const message = messageField.value.trim();
      if (!message) return;

      const user = auth.currentUser;
      db.collection("messages").add({
        userName: user.displayName,
        userPhoto: user.photoURL,
        message: message,
        timestamp: firebase.firestore.FieldValue.serverTimestamp()
      }).then(() => {
        messageField.value = '';
        messageField.style.height = 'auto';
      });
    }

    messageField.addEventListener('keydown', function(e) {
      if (e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
        sendMessage();
      }
    });

    function formatTime(timestamp) {
      if (!timestamp) return '';
      const date = timestamp.toDate();
      return `${date.getHours()}:${date.getMinutes().toString().padStart(2, '0')}`;
    }

    function loadMessages() {
      db.collection("messages").orderBy("timestamp")
        .onSnapshot(snapshot => {
          chatBox.innerHTML = '';
          snapshot.forEach(doc => {
            const data = doc.data();
            const time = formatTime(data.timestamp);
            chatBox.innerHTML += `
              <div class="message-group">
                <div class="content">
                  <div><span class="username">${data.userName}</span><span class="timestamp">${time}</span></div>
                  <div>${data.message}</div>
                </div>
                <img class="profile-pic" src="${data.userPhoto}" alt="Profile">
              </div>`;
          });

          chatBox.scrollTop = chatBox.scrollHeight;
        });
    }
  </script>
</body>
</html>
